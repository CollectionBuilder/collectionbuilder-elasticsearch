class e extends HTMLElement{constructor(){super(),this.classList.add("btn","btn-info","my-2","w-100"),this.classList.add("cursor-pointer")}connectedCallback(){this.attributeChangedCallback("num-applied",void 0,this.getAttribute("num-applied"))}static get observedAttributes(){return["num-applied"]}attributeChangedCallback(e,t,s){const i=parseInt(s,10);this.textContent=`Clear ${i} Filters`,0===i?this.classList.add("d-none"):this.classList.remove("d-none")}}customElements.define("clear-filters",e);class t extends Map{pop(e){if(!this.has(e))return;const t=this.get(e);return this.delete(e),t}}function s(e){const t=document.createElement("div");t.innerHTML=e.trim();const s=t.firstChild;return t.removeChild(s),s}const i=e=>e.split("_").map((e=>e[0].toUpperCase()+e.slice(1))).join(" "),n=e=>Array.from(e.children).forEach((e=>e.remove()));function a(){const e=new t,s=new URLSearchParams(window.location.search);return Array.from(s.entries()).forEach((([t,s])=>{const i=t.endsWith("[]");e.has(t)?i?e.get(t).push(s):console.warn(`Duplicate search key "${t}" does not end with "[]"`):e.set(t,i?[s]:s)})),e}function l(e){const t=new URL(window.location.href);t.search=e,window.history.pushState(null,document.title,t)}function r(e,t,s){if(e.hasAttribute(t))return e.getAttribute(t);if(void 0!==s)return s;throw console.warn(e),new Error(`Element (previous console warning) has no attribute: "${t}"`)}class c extends HTMLElement{constructor(){super(),this.defaultNumVisible=5,this.showAll=!1,this.classList.add("d-block"),this.showMoreEl=s('<button class="btn btn-info w-100 rounded-0 pt-1 pb-1 show-more">\n         show more\n       </button>'),this.showMoreEl.addEventListener("click",this.toggleShowAll.bind(this)),this.appendChild(this.showMoreEl)}connectedCallback(){this.hasAttribute("initial-num-visible")&&(this.defaultNumVisible=parseInt(this.getAttribute("initial-num-visible"),10)),this.valueElsSlice=Array.from(this.querySelectorAll("search-facet-value")).slice(this.defaultNumVisible),0===this.valueElsSlice.length&&(this.showMoreEl.style.display="none"),this.showAllChangeHandler()}showAllChangeHandler(){this.querySelector(".show-more").textContent=this.showAll?"show fewer":"show more";const e=this.showAll?"d-flex":"d-none",t=this.showAll?"d-none":"d-flex";this.valueElsSlice.forEach((s=>{s.classList.remove(t),s.classList.add(e)}))}toggleShowAll(){this.showAll=!this.showAll,this.showAllChangeHandler()}}customElements.define("search-facet-values",c);class o extends HTMLElement{constructor(){super(),this.classList.add("d-flex","py-1","px-2","btn","btn-light","border-bottom","rounded-0"),this.classList.add("cursor-pointer"),this.innerHTML='<span class="text-truncate pr-2 name"></span>\n       <span class="ml-auto doc-count"></span>\n      '}connectedCallback(){const e=this.getAttribute("value"),t=this.getAttribute("doc-count"),s=this.hasAttribute("selected"),i=this.querySelector(".name");i.textContent=e,i.setAttribute("title",e),this.querySelector(".doc-count").textContent=s?"x":t,s&&(this.classList.remove("btn-light"),this.classList.add("btn-info"))}}customElements.define("search-facet-value",o);class h extends HTMLElement{constructor(){super(),this.collapsed=!1,this.valueClickListeners=[],this.name=void 0,this.displayName=void 0,this.classList.add("d-block","border","border-secondary","rounded","overflow-hidden","mb-4","w-100"),this.appendChild(s('<h1 class="d-flex bg-dark text-white-50 font-weight-bold p-2 mb-0 text-nowrap h6\n                  cursor-pointer">\n         <span class="name"></span>\n         <span class="font-weight-bold text-monospace ml-auto collapsed-icon">-</span>\n       </h1>')),this.appendChild(s("<slot></slot>"))}connectedCallback(){this.name=this.getAttribute("name"),this.displayName=this.getAttribute("display-name");const e=this.querySelector("search-facet-values");this.querySelector("slot").replaceWith(e),this.hasAttribute("collapsed")&&this.toggleCollapsed(),this.querySelector("h1 > span.name").textContent=this.displayName,this.querySelector("h1").addEventListener("click",this.toggleCollapsed.bind(this)),this.querySelector("search-facet-values").addEventListener("click",this.valueClickHandler.bind(this))}toggleCollapsed(){this.collapsed=!this.collapsed,this.querySelector("h1 > span.collapsed-icon").textContent=this.collapsed?"+":"-";const e=this.querySelector("search-facet-values");this.collapsed?(e.classList.remove("d-block"),e.classList.add("d-none")):(e.classList.remove("d-none"),e.classList.add("d-block"))}addValueClickListener(e){this.valueClickListeners.push(e)}removeValueClickListener(e){for(let t=0;t<this.valueClickListeners.length;t+=1)if(this.valueClickListeners[t]===e)return void this.valueClickListeners.splice(t,1)}valueClickHandler(e){const t=e.target.closest("search-facet-value");if(null===t)return;const s=t.getAttribute("value");this.valueClickListeners.forEach((e=>e(this.name,s)))}}customElements.define("search-facet",h);class d extends h{constructor(e){super(),this.setAttribute("collapsed","");const t=s(`<search-facet-values>\n        <search-facet-value\n           value="Go to the multi-collection search page to access ${e} additional collections"\n           doc-count="">\n        </search-facet-value>\n      </search-facet-values>`);t.querySelector("search-facet-value .name").classList.remove("text-truncate"),this.valueClickHandler=e=>{e.stopPropagation(),window.location.pathname="/multi-collection-search/"},this.appendChild(t)}connectedCallback(){this.setAttribute("name","other-collections"),this.setAttribute("display-name","Other Collections"),super.connectedCallback()}}customElements.define("multi-collection-cta-facet",d);class u extends HTMLElement{constructor(e,t){super(),this.aggregations=e,this.includeKeys=t,this.valueClickListeners=[]}connectedCallback(){(this.includeKeys||Object.keys(this.aggregations)).forEach((e=>{const{buckets:t}=this.aggregations[e];if(0===t.length)return;const n=(a=e,new URLSearchParams(window.location.search).getAll(`${a}[]`)).reverse();var a;t.sort(((e,t)=>n.indexOf(t.key)-n.indexOf(e.key)));const l=s(`<search-facet name="${e}" display-name="${i(e)}">\n           <search-facet-values initial-num-visible="5">\n             ${t.map((e=>`<search-facet-value value="${e.key}"\n                             doc-count="${e.doc_count}"\n                             ${n.includes(e.key)?"selected":""}>\n         </search-facet-value>`)).join("")}\n           </search-facet-values>\n         </search-facet>`);this.appendChild(l);const r=l.querySelectorAll("search-facet-value");r[r.length-1].classList.remove("border-bottom"),l.addValueClickListener(this.valueClickHandler.bind(this))}))}addValueClickListener(e){this.valueClickListeners.push(e)}removeValueClickListener(e){for(let t=0;t<this.valueClickListeners.length;t+=1)if(this.valueClickListeners[t]===e)return void this.valueClickListeners.splice(t,1)}valueClickHandler(e,t){this.valueClickListeners.forEach((s=>s(e,t)))}}customElements.define("search-facets",u);class p extends HTMLElement{constructor(e){super(),this.innerHTML='<button class="btn btn-secondary mb-2 w-100">Show Filters</button>\n       <div class="outer d-none position-fixed"\n            style="top: 0; right: 0; bottom: 0; left: 0;\n                   background-color: rgba(200, 200, 200, 0.95); z-index: 2;\n                   overflow-y: auto;">\n         <div class="inner w-75 my-2 mx-auto"></div>\n       </div>\n      ',this.outerEl=this.querySelector(".outer"),this.innerEl=this.querySelector(".inner"),this.innerEl.appendChild(e),this.querySelector("button").addEventListener("click",this.buttonClickHandler.bind(this)),this.outerEl.addEventListener("click",this.facetsClickHandler.bind(this)),this.addEventListener("keydown",this.keydownHandler)}show(){this.outerEl.classList.remove("d-none"),this.outerEl.classList.add("d-flex"),document.body.style.overflow="hidden",document.body.style.marginRight="16px"}hide(){this.outerEl.classList.remove("d-flex"),this.outerEl.classList.add("d-none"),document.body.style.overflow="visible",document.body.style.marginRight=0}buttonClickHandler(e){e.stopPropagation(),this.show()}facetsClickHandler(e){e.stopPropagation(),"H1"!==e.target.tagName&&"BUTTON"!==e.target.tagName&&"H1"!==e.target.parentElement.tagName&&this.hide()}keydownHandler(e){"Escape"===e.key&&this.hide()}}customElements.define("mobile-search-facets",p);class m extends HTMLButtonElement{constructor(e,t,s,i=!1){super(),this.innerHTML=e,this.start=t,this.disabled=s,this.classList.add("mr-1","btn"),i?this.classList.add("btn-primary"):this.classList.add("btn-light","border-secondary")}}customElements.define("paginator-button",m,{extends:"button"});const f=s('<span class="position-relative mr-1" style="top: .4em">&#8230;</span>');class g extends HTMLElement{connectedCallback(){const e=parseInt(r(this,"num-total"),10),t=parseInt(r(this,"page-size"),10),s=parseInt(r(this,"current-page"),10),i=Math.ceil(e/t),n=s>3,a=i-s>2,l=e=>t*(e-1);this.appendChild(new m("&laquo;&nbsp;prev",l(s-1),1===s)),n&&(this.appendChild(new m("1",l(1),!1)),this.appendChild(f.cloneNode(!0)));let c=-2;for(;c<=2;){const e=s+c;if(e>0&&(1!==e||!n)&&(e!==i||!a)&&e<=i){const t=e===s;this.appendChild(new m(`${e}`,l(e),t,t))}c+=1}a&&(this.appendChild(f.cloneNode(!0)),this.appendChild(new m(`${i}`,l(i),!1)));const o=new m("next&nbsp;&raquo;",l(s+1),s===i);this.appendChild(o),o.classList.remove("mr-1")}}customElements.define("paginator-control",g);class b extends HTMLSelectElement{constructor(){super(),this.classList.add("bg-white")}connectedCallback(){const e=this.getAttribute("value"),t=this.getAttribute("options").split(",");t.includes(e)||t.push(e),t.forEach((t=>{this.appendChild(s(`<option value="${t}"\n                 ${t===e?"selected":""}>\n           ${t}\n         </option>\n        `))}))}}customElements.define("page-size-selector",b,{extends:"select"});class y extends HTMLElement{constructor(e,t,s){super(),this.numHits=e,this.start=t,this.size=s,this.startIdx=t+1,this.endIdx=this.startIdx+Math.min(e-this.startIdx,s-1),this.classList.add("d-flex")}connectedCallback(){if(0!==this.numHits)return this.endIdx<this.startIdx?(this.classList.add("bg-warning","text-dark","p-3"),void(this.textContent=`Query "start" value (${this.start}) exceeds the number of total results (${this.numHits})`)):void(this.innerHTML=`<span class="h4 text-nowrap">\n         Showing ${this.startIdx} - ${this.endIdx} of ${this.numHits} Results\n       </span>\n       <div class="ml-auto text-right">\n         <span class="text-nowrap">\n           <label for="results-per-page">Results per page</label>\n           <select is="page-size-selector" value="${this.size}" options="10,25,50,100"\n                   class="cursor-pointer">\n           </select>\n         </span>\n         <paginator-control num-total="${this.numHits}" page-size="${this.size}"\n                            current-page="${Math.floor(this.startIdx/this.size)+1}"\n                            class="d-block mt-1 mb-2">\n         </paginator-control>\n       </div>\n      `);this.innerHTML='<span class="h4 text-nowrap">\n           No results found\n         </span>'}}customElements.define("search-results-header",y);class v extends HTMLElement{constructor(e,t,n){super(),this.classList.add("d-flex","border-top","p-4"),this.innerHTML=`<a href="${e.url}">\n         <img src="${e.thumbnailContentUrl}" style="width: 100px">\n       </a>\n       <div class="details">\n         <h1 class="h4 ml-3">\n           <a href="${e.url}">${e[t[0]]}</a>\n         </h1>\n         \x3c!-- Non-title display fields will be appended here --\x3e\n       </div>`;const a=this.querySelector(".details");n&&a.appendChild(s(`<p class="ml-3 mb-1">\n             Collection: <a href="${e.collectionUrl}">${e.collectionTitle}</a>\n           </p>`)),t.slice(1).forEach((t=>{const n=e[t];void 0!==n&&a.appendChild(s(`<p class="ml-3 mb-1">${i(t)}: ${n}</p>`))}))}}customElements.define("search-result",v);class w extends HTMLElement{constructor(e,t,s){super(),this.hits=e,this.displayFields=t,this.isMulti=s}connectedCallback(){this.hits.forEach((e=>{this.appendChild(new v(e._source,this.displayFields,this.isMulti))}))}}async function C(e,t,s){let i,n;try{i=await fetch(`${e}/${t.join(",")}/_search`,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(s)})}catch(e){return null}if(!i.headers.get("Content-Type").startsWith("application/json"))return null;try{n=await i.json()}catch(e){return null}return i.ok?n:(n.error&&n.error.reason&&console.error(`Search error: ${n.error.reason}`),null)}customElements.define("search-results",w);class k extends HTMLElement{constructor(){super(),this.indicesDirectoryIndexTitleMap=new Map,this.indicesDirectoryTitleIndexMap=new Map,this.style.fontSize="1rem",this.appendChild(s('\n      <div class="container position-relative">\n\n        <div id="search-overlay" class="position-absolute w-100 h-100 d-flex"\n             style="top: 0; background-color: rgba(255, 255, 255, 0.5);">\n          <div class="spinner-border ml-auto mr-auto" role="status">\n            <span class="sr-only">Loading...</span>\n          </div>\n        </div>\n\n        <div class="row">\n          <div class="col-4 d-none d-lg-block" id="search-facets"></div>\n          <div class="col">\n            <input type="text" class="form-control mb-2" placeholder="Search" aria-label="search box">\n            <div id="mobile-search-facets" class="d-lg-none"></div>\n            <clear-filters num-applied="0"></clear-filters>\n            <div class="results-header"></div>\n            <div class="results"></div>\n          </div>\n        </div>\n      </div>\n      ')),this.searchOverlay=this.querySelector("#search-overlay"),this.searchOverlay.remove(),this.clearFiltersButton=this.querySelector("clear-filters"),this.searchInput=this.querySelector("input[type=text]");const e=a();e.has("q")&&(this.searchInput.value=e.get("q"))}async connectedCallback(){const e=this.getAttribute("elasticsearch-url");try{this.esUrl=new URL(e).origin}catch(e){throw new Error('Please specify a valid <es-search> element "elasticsearch-url" value')}if(this.esIndex=this.getAttribute("elasticsearch-index"),!this.esIndex)throw new Error('Please specify a valid <es-search> element "elasticsearch-index" value');if(this.hasAttribute("fields")){let e=this.getAttribute("fields");e=e.split(","),this.allFields=e.slice(0,e.length-1)}else this.allFields=[];if(this.hasAttribute("faceted-fields")){let e=this.getAttribute("faceted-fields");e=e.split(","),this.facetedFields=e.slice(0,e.length-1)}else this.facetedFields=[];if(this.hasAttribute("display-fields")){let e=this.getAttribute("display-fields");e=e.split(","),this.displayFields=e.slice(0,e.length-1)}else this.displayFields=[];this.isMulti=this.hasAttribute("search-multi");(await async function(e){const t=await await fetch(`${e}/directory_/_search`);if(200===t.status)return(await t.json()).hits.hits.map((e=>e._source));return console.error("Unable to retrieve the indices directory from the Elasticsearch server"),[]}(this.esUrl)).forEach((({index:e,title:t})=>{this.indicesDirectoryIndexTitleMap.set(e,t),this.indicesDirectoryTitleIndexMap.set(t,e)})),this.searchInput.addEventListener("keydown",this.searchInputKeydownHandler.bind(this)),this.clearFiltersButton.addEventListener("click",this.clearFiltersClickHandler.bind(this)),window.addEventListener("popstate",(()=>this.search.bind(this)())),this.search()}async search(){this.showOverlay();const e=a();let t,s=0;this.isMulti?(t=e.get("collection[]"),t?(e.delete("collection[]"),s+=t.length):t=Array.from(this.indicesDirectoryTitleIndexMap.keys())):t=[this.indicesDirectoryIndexTitleMap.get(this.esIndex)];const i=t.map((e=>this.indicesDirectoryTitleIndexMap.get(e))),n=e.pop("q")||"",l=parseInt(e.pop("start")||0,10),r=parseInt(e.pop("size")||10,10);let c=["*"];e.has("fields")&&(c=e.pop("fields").split(","));const o=new Map;Array.from(e.entries()).forEach((([e,t])=>{const i=e.endsWith("[]"),n=`${i?e.slice(0,e.length-2):e}.raw`,a=i?t:[t];o.set(n,a),s+=a.length}));const h=new Map;this.facetedFields.forEach((e=>h.set(e,`${e}.raw`)));const d=function(e,{q:t="",filters:s={},start:i=0,size:n=10,fields:a=["*"],aggregationNameFieldMap:l={},_source:r="*"}){let c={match_all:{}};t.length>0&&(c={simple_query_string:{query:t,default_operator:"and",fields:a}});const o=[];Array.from(s.entries()).forEach((([e,t])=>{(Array.isArray(t)?t:[t]).forEach((t=>{o.push({term:{[e]:t}})}))}));const h={from:i,size:n,query:{}};return 0===o.length?h.query=c:h.query={bool:{must:c,filter:o}},h.aggs={},Array.from(l.entries()).forEach((([e,t])=>{h.aggs[e]={terms:{field:t,size:25}}})),h._source=r,h}(0,{q:n,filters:o,start:l,size:r,fields:c,aggregationNameFieldMap:h,_source:{excludes:["full_text"]}}),u=Array.from(this.indicesDirectoryIndexTitleMap.keys()),p={size:0,query:d.query,aggs:{collection:{terms:{field:"_index",size:u.length}}}},[m,f]=await Promise.all([C(this.esUrl,i,d),C(this.esUrl,u,p)]),g=f.aggregations.collection,b=g.buckets.map((({key:e})=>e));u.filter((e=>!b.includes(e))).forEach((e=>g.buckets.push({key:e,doc_count:0})));for(let e=0;e<g.buckets.length;e+=1){const t=g.buckets[e];t.key=this.indicesDirectoryIndexTitleMap.get(t.key)}m.aggregations.collection=g,this.clearFiltersButton.setAttribute("num-applied",s),this.renderFacets(m.aggregations),this.renderResultsHeader(m.hits.total.value,l,r),this.renderResults(m.hits.hits),this.hideOverlay()}showOverlay(){this.querySelector(".container").appendChild(this.searchOverlay)}hideOverlay(){this.searchOverlay.remove()}async renderFacets(e){let t=this.facetedFields;this.isMulti&&(t=["collection"].concat(t));const s=this.querySelector("#search-facets"),i=this.querySelector("#mobile-search-facets");n(s),n(i);const a=new u(e,t),l=new u(e,t);if(!this.isMulti){const e=this.indicesDirectoryIndexTitleMap.size-1;a.insertBefore(new d(e),a.children[0]),l.insertBefore(new d(e),l.children[0])}a.addValueClickListener(this.facetValueClickHandler.bind(this)),l.addValueClickListener(this.facetValueClickHandler.bind(this)),s.appendChild(a),i.appendChild(new p(l))}async renderResultsHeader(e,t,s){const i=this.querySelector("div.results-header");n(i);const a=new y(e,t,s);i.appendChild(a),e>0&&(a.querySelector("select[is=page-size-selector]").addEventListener("change",this.pageSizeSelectorChangeHandler.bind(this)),a.querySelector("paginator-control").addEventListener("click",this.paginatorClickHandler.bind(this)))}async renderResults(e){const t=this.querySelector("div.results");let s=t.querySelector("search-results");null!==s&&s.remove(),s=new w(e,this.displayFields,this.isMulti),t.appendChild(s)}facetValueClickHandler(e,t){const s=new URLSearchParams(window.location.search),i=`${e}[]`;let n=s.getAll(i);n.includes(t)?n=n.filter((e=>e!==t)):n.push(t),s.delete(i),n.forEach((e=>s.append(i,e))),s.delete("start"),l(s),this.search()}searchInputKeydownHandler(e){if("Enter"!==e.key)return;const t=e.target;t.blur();const s=t.value,i=new URLSearchParams(window.location.search);i.set("q",s),i.delete("start"),l(i),this.search()}pageSizeSelectorChangeHandler(e){const t=e.target.value,s=new URLSearchParams(window.location.search);s.set("size",t),s.delete("start"),l(s),this.search()}clearFiltersClickHandler(e){e.stopPropagation();const t=new URLSearchParams(window.location.search);new Set(Array.from(t.keys()).filter((e=>e.endsWith("[]")))).forEach((e=>t.delete(e))),t.delete("start"),l(t),this.search()}paginatorClickHandler(e){e.stopPropagation();const{target:t}=e;if("BUTTON"!==t.tagName)return;const{start:s}=t,i=new URLSearchParams(window.location.search);0===s?i.delete("start"):i.set("start",s),l(i),this.search()}}customElements.define("search-app",k);
